<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Box Pattern</title>
    <style>
        .b-container {
            display: flex;
            justify-content: center;
            height: 100%;
        }

        .container {
            display: flex;
            flex-wrap: wrap;
            width: 800px;
            outline: 2px dotted black;
        }

        .row {
            display: flex;
            width: 100%;
        }

        .boxes-green,
        .boxes-white {
            width: 100px;
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .boxes-green {
            background-color: rgb(115, 149, 82);
        }

        .boxes-white {
            background-color: rgb(235, 236, 208);
        }

        button {
            border: none;
            background: none;
            padding: 0;
            margin: 0;
        }
    </style>
</head>

<body>
    <div class="b-container">
        <div class="container">
            <div class="row">
                <button class="boxes-green 0,0" id="w-rook-1"></button>
                <button class="boxes-white 0,1" id="w-knight-1"></button>
                <button class="boxes-green 0,2" id="w-bishop-1"></button>
                <button class="boxes-white 0,3" id="w-queen-1"></button>
                <button class="boxes-green 0,4" id="w-king"></button>
                <button class="boxes-white 0,5" id="w-bishop-2"></button>
                <button class="boxes-green 0,6" id="w-knight-2"></button>
                <button class="boxes-white 0,7" id="w-rook-2"></button>
            </div>
            <div class="row">
                <button class="boxes-white 1,0" id="w-p-1"></button>
                <button class="boxes-green 1,1" id="w-p-2"></button>
                <button class="boxes-white 1,2" id="w-p-3"></button>
                <button class="boxes-green 1,3" id="w-p-4"></button>
                <button class="boxes-white 1,4" id="w-p-5"></button>
                <button class="boxes-green 1,5" id="w-p-6"></button>
                <button class="boxes-white 1,6" id="w-p-7"></button>
                <button class="boxes-green 1,7" id="w-p-8"></button>
            </div>
            <div class="row">
                <button class="boxes-green 2,0"></button>
                <button class="boxes-white 2,1"></button>
                <button class="boxes-green 2,2"></button>
                <button class="boxes-white 2,3"></button>
                <button class="boxes-green 2,4"></button>
                <button class="boxes-white 2,5"></button>
                <button class="boxes-green 2,6"></button>
                <button class="boxes-white 2,7"></button>
            </div>
            <div class="row">
                <button class="boxes-white 3,0"></button>
                <button class="boxes-green 3,1"></button>
                <button class="boxes-white 3,2"></button>
                <button class="boxes-green 3,3"></button>
                <button class="boxes-white 3,4"></button>
                <button class="boxes-green 3,5"></button>
                <button class="boxes-white 3,6"></button>
                <button class="boxes-green 3,7"></button>
            </div>
            <div class="row">
                <button class="boxes-green 4,0"></button>
                <button class="boxes-white 4,1"></button>
                <button class="boxes-green 4,2"></button>
                <button class="boxes-white 4,3"></button>
                <button class="boxes-green 4,4"></button>
                <button class="boxes-white 4,5"></button>
                <button class="boxes-green 4,6"></button>
                <button class="boxes-white 4,7"></button>
            </div>
            <div class="row">
                <button class="boxes-white 5,0"></button>
                <button class="boxes-green 5,1"></button>
                <button class="boxes-white 5,2"></button>
                <button class="boxes-green 5,3"></button>
                <button class="boxes-white 5,4"></button>
                <button class="boxes-green 5,5"></button>
                <button class="boxes-white 5,6"></button>
                <button class="boxes-green 5,7"></button>
            </div>
            <div class="row">
                <button class="boxes-green 6,0" id="b-p-1"></button>
                <button class="boxes-white 6,1" id="b-p-2"></button>
                <button class="boxes-green 6,2" id="b-p-3"></button>
                <button class="boxes-white 6,3" id="b-p-4"></button>
                <button class="boxes-green 6,4" id="b-p-5"></button>
                <button class="boxes-white 6,5" id="b-p-6"></button>
                <button class="boxes-green 6,6" id="b-p-7"></button>
                <button class="boxes-white 6,7" id="b-p-8"></button>
            </div>
            <div class="row">
                <button class="boxes-white 7,0" id="b-rook-1"></button>
                <button class="boxes-green 7,1" id="b-knight-1"></button>
                <button class="boxes-white 7,2" id="b-bishop-1"></button>
                <button class="boxes-green 7,3" id="b-queen-1"></button>
                <button class="boxes-white 7,4" id="b-king"></button>
                <button class="boxes-green 7,5" id="b-bishop-2"></button>
                <button class="boxes-white 7,6" id="b-knight-2"></button>
                <button class="boxes-green 7,7" id="b-rook-2"></button>
            </div>
        </div>
    </div>

    <script>
        function addPieceImages() {
            // White pieces
            const whitePieces = {
                'w-rook-1': 'https://upload.wikimedia.org/wikipedia/commons/5/5c/Chess_rlt60.png',
                'w-rook-2': 'https://upload.wikimedia.org/wikipedia/commons/5/5c/Chess_rlt60.png',
                'w-bishop-1': 'https://upload.wikimedia.org/wikipedia/commons/9/9b/Chess_blt60.png',
                'w-bishop-2': 'https://upload.wikimedia.org/wikipedia/commons/9/9b/Chess_blt60.png',
                'w-knight-1': 'https://upload.wikimedia.org/wikipedia/commons/2/28/Chess_nlt60.png',
                'w-knight-2': 'https://upload.wikimedia.org/wikipedia/commons/2/28/Chess_nlt60.png',
                'w-queen-1': 'https://upload.wikimedia.org/wikipedia/commons/4/49/Chess_qlt60.png',
                'w-king': 'https://upload.wikimedia.org/wikipedia/commons/3/3b/Chess_klt60.png',
                'w-p-1': 'https://upload.wikimedia.org/wikipedia/commons/0/04/Chess_plt60.png',
                'w-p-2': 'https://upload.wikimedia.org/wikipedia/commons/0/04/Chess_plt60.png',
                'w-p-3': 'https://upload.wikimedia.org/wikipedia/commons/0/04/Chess_plt60.png',
                'w-p-4': 'https://upload.wikimedia.org/wikipedia/commons/0/04/Chess_plt60.png',
                'w-p-5': 'https://upload.wikimedia.org/wikipedia/commons/0/04/Chess_plt60.png',
                'w-p-6': 'https://upload.wikimedia.org/wikipedia/commons/0/04/Chess_plt60.png',
                'w-p-7': 'https://upload.wikimedia.org/wikipedia/commons/0/04/Chess_plt60.png',
                'w-p-8': 'https://upload.wikimedia.org/wikipedia/commons/0/04/Chess_plt60.png'
            };

            // Black pieces
            const blackPieces = {
                'b-rook-1': 'https://upload.wikimedia.org/wikipedia/commons/a/a0/Chess_rdt60.png',
                'b-rook-2': 'https://upload.wikimedia.org/wikipedia/commons/a/a0/Chess_rdt60.png',
                'b-bishop-1': 'https://upload.wikimedia.org/wikipedia/commons/8/81/Chess_bdt60.png',
                'b-bishop-2': 'https://upload.wikimedia.org/wikipedia/commons/8/81/Chess_bdt60.png',
                'b-knight-1': 'https://upload.wikimedia.org/wikipedia/commons/f/f1/Chess_ndt60.png',
                'b-knight-2': 'https://upload.wikimedia.org/wikipedia/commons/f/f1/Chess_ndt60.png',
                'b-queen-1': 'https://upload.wikimedia.org/wikipedia/commons/a/af/Chess_qdt60.png',
                'b-king': 'https://upload.wikimedia.org/wikipedia/commons/e/e3/Chess_kdt60.png',
                'b-p-1': 'https://upload.wikimedia.org/wikipedia/commons/c/cd/Chess_pdt60.png',
                'b-p-2': 'https://upload.wikimedia.org/wikipedia/commons/c/cd/Chess_pdt60.png',
                'b-p-3': 'https://upload.wikimedia.org/wikipedia/commons/c/cd/Chess_pdt60.png',
                'b-p-4': 'https://upload.wikimedia.org/wikipedia/commons/c/cd/Chess_pdt60.png',
                'b-p-5': 'https://upload.wikimedia.org/wikipedia/commons/c/cd/Chess_pdt60.png',
                'b-p-6': 'https://upload.wikimedia.org/wikipedia/commons/c/cd/Chess_pdt60.png',
                'b-p-7': 'https://upload.wikimedia.org/wikipedia/commons/c/cd/Chess_pdt60.png',
                'b-p-8': 'https://upload.wikimedia.org/wikipedia/commons/c/cd/Chess_pdt60.png'
            };

            // Add images to white pieces
            for (const [id, src] of Object.entries(whitePieces)) {
                const element = document.getElementById(id);
                if (element) {
                    const img = document.createElement('img');
                    img.src = src;
                    img.alt = id;
                    img.style.width = '100%';
                    img.style.height = '100%';
                    element.appendChild(img);
                }
            }

            // Add images to black pieces
            for (const [id, src] of Object.entries(blackPieces)) {
                const element = document.getElementById(id);
                if (element) {
                    const img = document.createElement('img');
                    img.src = src;
                    img.alt = id;
                    img.style.width = '100%';
                    img.style.height = '100%';
                    element.appendChild(img);
                }
            }
        }

        document.addEventListener('DOMContentLoaded', addPieceImages);


        const buttons = document.querySelectorAll('.boxes-green, .boxes-white');

        let firstClick = null;
        var num_piece = []
        var elem = []
        var elem_id = []
        var white_pawns = ['1,0', '1,1', '1,2', '1,3', '1,4', '1,5', '1,6', '1,7']
        var black_pawns = ['6,0', '6,1', '6,2', '6,3', '6,4', '6,5', '6,6', '6,7']

        var en_white = ['3,0', '3,1', '3,2', '3,3', '3,4', '3,5', '3,6', '3,7']
        var en_black = ['4,0', '4,1', '4,2', '4,3', '4,4', '4,5', '4,6', '4,7']
        let initialNumPieceLength = 0;

        let castle_black = false;
        let castle_white = false;
        let new_castle_white = false;
        let castleExecuted_white = false;
        let new_castle_black = false;
        let castleExecuted_black = false;

        let en_pas_white = false;
        let en_pas_black = false;

        let queen_castle_black = false;

        buttons.forEach(button => {
            button.onclick = function () {
                if (!firstClick) {
                    firstClick = button;
                    var first_co = firstClick.getAttribute('class').split(' ')[1];
                    var first_id = firstClick.id;
                    var first_color = first_id.split('-')[0]
                    var piece = first_id.split('-')[1]
                    //piece algo 

                    //en-pasant-black
                    if (piece == 'p' && first_color == 'b') {
                        let [x, y] = first_co.split(',');
                        x = parseInt(x);
                        y = parseInt(y);
                        y = y - 1
                        let new_co = x + ',' + y
                        y = y + 1
                        y = y + 1
                        let new_co_0 = x + ',' + y
                        let temp_co = document.querySelector(`button[class$="${new_co}"]`);
                        let temp_co_0 = document.querySelector(`button[class$="${new_co_0}"]`);
                        if (en_white.includes(new_co) && temp_co.id) {
                            let [x, y] = new_co.split(',');
                            x = parseInt(x);
                            y = parseInt(y);
                            x = x - 1;
                            new_co = x + ',' + y;
                            new_co = document.querySelector(`button[class$="${new_co}"]`);
                            new_co.innerHTML += '<div style="height: 40px; width: 40px; opacity: 0.85 ;border: 10px solid #bbb; border-radius:50px;display: flex; z-index: 100; position: absolute;"></div>';
                            en_pas_black = true;
                        }
                        if (en_white.includes(new_co_0) && temp_co_0.id) {
                            let [x, y] = new_co_0.split(',');
                            x = parseInt(x);
                            y = parseInt(y);
                            x = x - 1;
                            new_co_0 = x + ',' + y;
                            new_co_0 = document.querySelector(`button[class$="${new_co_0}"]`);
                            new_co_0.innerHTML += '<div style="height: 40px; width: 40px; opacity: 0.85 ;border: 10px solid #bbb; border-radius:50px;display: flex; z-index: 100; position: absolute;"></div>';
                            en_pas_black = true;
                        }
                    }

                    //en-pasant-white
                    if (piece == 'p' && first_color == 'w') {
                        let [x, y] = first_co.split(',');
                        x = parseInt(x);
                        y = parseInt(y);
                        y = y + 1
                        let new_co = x + ',' + y
                        y = y - 1
                        y = y - 1
                        let new_co_0 = x + ',' + y
                        let temp_co = document.querySelector(`button[class$="${new_co}"]`);
                        let temp_co_0 = document.querySelector(`button[class$="${new_co_0}"]`);
                        if (en_black.includes(new_co) && temp_co.id) {
                            let [x, y] = new_co.split(',');
                            x = parseInt(x);
                            y = parseInt(y);
                            x = x + 1;
                            new_co = x + ',' + y;
                            new_co = document.querySelector(`button[class$="${new_co}"]`);
                            new_co.innerHTML += '<div style="height: 40px; width: 40px; opacity: 0.85 ;border: 10px solid #bbb; border-radius:50px;display: flex; z-index: 100; position: absolute;"></div>';
                            en_pas_white = true;
                        }
                        if (en_black.includes(new_co_0) && temp_co_0.id) {
                            let [x, y] = new_co_0.split(',');
                            x = parseInt(x);
                            y = parseInt(y);
                            x = x + 1;
                            new_co_0 = x + ',' + y;
                            console.log(new_co_0)
                            new_co_0 = document.querySelector(`button[class$="${new_co_0}"]`);
                            new_co_0.innerHTML += '<div style="height: 40px; width: 40px; opacity: 0.85 ;border: 10px solid #bbb; border-radius:50px;display: flex; z-index: 100; position: absolute;"></div>';
                            en_pas_white = true;
                        }
                    }

                    //pawn black
                    if (piece == 'p' && first_color == 'b' && !black_pawns.includes(first_co)) {
                        let [x, y] = first_co.split(',');
                        x = parseInt(x);
                        y = parseInt(y);
                        x = x - 1;
                        let new_co = x + ',' + y;
                        let currentButton_in = document.querySelector(`button[class$="${new_co}"]`);
                        let currentButton_color = currentButton_in.id;
                        currentButton_color = currentButton_color.split("-")[0]
                        if (currentButton_in && !currentButton_in.id) {
                            num_piece.push(new_co);
                        }
                        x = x + 1;

                        x = x - 1;
                        y = y + 1;
                        let new_co_0 = x + ',' + y;
                        let currentButton = document.querySelector(`button[class$="${new_co_0}"]`);
                        currentButton_color = currentButton.id;
                        currentButton_color = currentButton_color.split("-")[0]
                        if (currentButton && currentButton.id) {
                            elem_id.push(currentButton.innerHTML);
                            elem.push(new_co_0);
                        }
                        x = x + 1;
                        y = y - 1;

                        x = x - 1;
                        y = y - 1;
                        let new_co_1 = x + ',' + y;
                        currentButton = document.querySelector(`button[class$="${new_co_1}"]`);
                        currentButton_color = currentButton.id;
                        currentButton_color = currentButton_color.split("-")[0]
                        if (currentButton && currentButton.id) {
                            elem_id.push(currentButton.innerHTML);
                            elem.push(new_co_1);
                        }
                    }
                    //don't change all good                   
                    if (piece == 'p' && first_color == 'b' && black_pawns.includes(first_co)) {
                        let [x, y] = first_co.split(',');
                        x = parseInt(x);
                        y = parseInt(y);
                        x = x - 1;
                        let new_co_0 = x + ',' + y;
                        currentButton = document.querySelector(`button[class$="${new_co_0}"]`);
                        currentButton_color = currentButton.id;
                        currentButton_color = currentButton_color.split("-")[0]
                        if (currentButton && !currentButton.id) {
                            num_piece.push(new_co_0)
                        }

                        x = x - 1;
                        let new_co_1 = x + ',' + y;
                        currentButton_0 = document.querySelector(`button[class$="${new_co_1}"]`);
                        currentButton_color_0 = currentButton_0.id;
                        currentButton_color_0 = currentButton_color_0.split("-")[0]
                        if (currentButton && !currentButton.id && currentButton_0 && !currentButton_0.id) {
                            num_piece.push(new_co_1)
                        }
                    }

                    //pawn white
                    if (piece == 'p' && first_color == 'w' && !white_pawns.includes(first_co)) {
                        let [x, y] = first_co.split(',');
                        x = parseInt(x);
                        y = parseInt(y);
                        x = x + 1;
                        let new_co = x + ',' + y;
                        let currentButton_in = document.querySelector(`button[class$="${new_co}"]`);
                        let currentButton_color = currentButton_in.id;
                        currentButton_color = currentButton_color.split("-")[0]
                        if (currentButton_in && !currentButton_in.id) {
                            num_piece.push(new_co);
                        }
                        x = x - 1;

                        x = x + 1;
                        y = y - 1;
                        let new_co_0 = x + ',' + y;
                        let currentButton = document.querySelector(`button[class$="${new_co_0}"]`);
                        currentButton_color = currentButton.id;
                        currentButton_color = currentButton_color.split("-")[0]
                        if (currentButton && currentButton.id) {
                            elem_id.push(currentButton.innerHTML);
                            elem.push(new_co_0);
                        }
                        x = x - 1;
                        y = y + 1;

                        x = x + 1;
                        y = y + 1;
                        let new_co_1 = x + ',' + y;
                        currentButton = document.querySelector(`button[class$="${new_co_1}"]`);
                        currentButton_color = currentButton.id;
                        currentButton_color = currentButton_color.split("-")[0]
                        if (currentButton && currentButton.id) {
                            elem_id.push(currentButton.innerHTML);
                            elem.push(new_co_1);
                        }
                    }
                    //don't change all good                   
                    if (piece == 'p' && first_color == 'w' && white_pawns.includes(first_co)) {
                        let [x, y] = first_co.split(',');
                        x = parseInt(x);
                        y = parseInt(y);
                        x = x + 1;
                        let new_co_0 = x + ',' + y;
                        currentButton = document.querySelector(`button[class$="${new_co_0}"]`);
                        currentButton_color = currentButton.id;
                        currentButton_color = currentButton_color.split("-")[0]
                        if (currentButton && !currentButton.id) {
                            num_piece.push(new_co_0)
                        }

                        x = x + 1;
                        let new_co_1 = x + ',' + y;
                        currentButton_0 = document.querySelector(`button[class$="${new_co_1}"]`);
                        currentButton_color_0 = currentButton_0.id;
                        currentButton_color_0 = currentButton_color_0.split("-")[0]
                        if (currentButton && !currentButton.id && currentButton_0 && !currentButton_0.id) {
                            num_piece.push(new_co_1)
                        }
                    }

                    //rook-white
                    if (piece == 'rook' && first_color == 'w') {
                        let [x, y] = first_co.split(',').map(Number);
                        const directions = [
                            [1, 0],
                            [-1, 0],
                            [0, 1],
                            [0, -1]
                        ];

                        for (let [dx, dy] of directions) {
                            let shouldContinue = true;
                            for (let i = 1; i < 9 && shouldContinue; i++) {
                                let newX = x + dx * i;
                                let newY = y + dy * i;
                                let new_co = `${newX},${newY}`;
                                const currentButton = document.querySelector(`button[class$="${new_co}"]`);
                                if (currentButton && currentButton.id) {
                                    let currentButton_color = currentButton.id
                                    currentButton_color = currentButton_color.split("-")[0];
                                    if (currentButton_color != first_color) {
                                        elem_id.push(currentButton.innerHTML);
                                        elem.push(new_co);
                                    }
                                    shouldContinue = false;
                                } else {
                                    num_piece.push(new_co);
                                }
                            }
                        }
                    }
                    //rook-black
                    if (piece == 'rook' && first_color == 'b') {
                        let [x, y] = first_co.split(',').map(Number);
                        const directions = [
                            [1, 0],
                            [-1, 0],
                            [0, 1],
                            [0, -1]
                        ];

                        for (let [dx, dy] of directions) {
                            let shouldContinue = true;
                            for (let i = 1; i < 9 && shouldContinue; i++) {
                                let newX = x + dx * i;
                                let newY = y + dy * i;
                                let new_co = `${newX},${newY}`;
                                const currentButton = document.querySelector(`button[class$="${new_co}"]`);
                                if (currentButton && currentButton.id) {
                                    let currentButton_color = currentButton.id
                                    currentButton_color = currentButton_color.split("-")[0];
                                    if (currentButton_color != first_color) {
                                        elem_id.push(currentButton.innerHTML);
                                        elem.push(new_co);
                                    }
                                    shouldContinue = false;
                                } else {
                                    num_piece.push(new_co);
                                }
                            }
                        }
                    }

                    //bishop-white
                    if (piece == 'bishop' && first_color == 'w') {
                        let [x, y] = first_co.split(',').map(Number);
                        const directions = [
                            [1, 1],
                            [-1, -1],
                            [-1, 1],
                            [1, -1]
                        ];

                        for (let [dx, dy] of directions) {
                            let shouldContinue = true;
                            for (let i = 1; i < 9 && shouldContinue; i++) {
                                let newX = x + dx * i;
                                let newY = y + dy * i;
                                let new_co = `${newX},${newY}`;
                                const currentButton = document.querySelector(`button[class$="${new_co}"]`);
                                if (currentButton && currentButton.id) {
                                    let currentButton_color = currentButton.id
                                    currentButton_color = currentButton_color.split("-")[0];
                                    if (currentButton_color != first_color) {
                                        elem_id.push(currentButton.innerHTML);
                                        elem.push(new_co);
                                    }
                                    shouldContinue = false;
                                } else {
                                    num_piece.push(new_co);
                                }
                            }
                        }
                    }
                    //bishop-black
                    if (piece == 'bishop' && first_color == 'b') {
                        let [x, y] = first_co.split(',').map(Number);
                        const directions = [
                            [1, 1],
                            [-1, -1],
                            [-1, 1],
                            [1, -1]
                        ];

                        for (let [dx, dy] of directions) {
                            let shouldContinue = true;
                            for (let i = 1; i < 9 && shouldContinue; i++) {
                                let newX = x + dx * i;
                                let newY = y + dy * i;
                                let new_co = `${newX},${newY}`;
                                const currentButton = document.querySelector(`button[class$="${new_co}"]`);
                                if (currentButton && currentButton.id) {
                                    let currentButton_color = currentButton.id
                                    currentButton_color = currentButton_color.split("-")[0];
                                    if (currentButton_color != first_color) {
                                        elem_id.push(currentButton.innerHTML);
                                        elem.push(new_co);
                                    }
                                    shouldContinue = false;
                                } else {
                                    num_piece.push(new_co);
                                }
                            }
                        }
                    }

                    //queen-black
                    if (piece == 'queen' && first_color == 'b') {
                        let [x, y] = first_co.split(',').map(Number);
                        const directions = [
                            [1, 1],
                            [-1, -1],
                            [-1, 1],
                            [1, -1],
                            [1, 0],
                            [-1, 0],
                            [0, 1],
                            [0, -1]
                        ];

                        for (let [dx, dy] of directions) {
                            let shouldContinue = true;
                            for (let i = 1; i < 9 && shouldContinue; i++) {
                                let newX = x + dx * i;
                                let newY = y + dy * i;
                                let new_co = `${newX},${newY}`;
                                const currentButton = document.querySelector(`button[class$="${new_co}"]`);
                                if (currentButton && currentButton.id) {
                                    let currentButton_color = currentButton.id
                                    currentButton_color = currentButton_color.split("-")[0];
                                    if (currentButton_color != first_color) {
                                        elem_id.push(currentButton.innerHTML);
                                        elem.push(new_co);
                                    }
                                    shouldContinue = false;
                                } else {
                                    num_piece.push(new_co);
                                }
                            }
                        }
                    }
                    //queen-white
                    if (piece == 'queen' && first_color == 'w') {
                        let [x, y] = first_co.split(',').map(Number);
                        const directions = [
                            [1, 1],
                            [-1, -1],
                            [-1, 1],
                            [1, -1],
                            [1, 0],
                            [-1, 0],
                            [0, 1],
                            [0, -1]
                        ];

                        for (let [dx, dy] of directions) {
                            let shouldContinue = true;
                            for (let i = 1; i < 9 && shouldContinue; i++) {
                                let newX = x + dx * i;
                                let newY = y + dy * i;
                                let new_co = `${newX},${newY}`;
                                const currentButton = document.querySelector(`button[class$="${new_co}"]`);
                                if (currentButton && currentButton.id) {
                                    let currentButton_color = currentButton.id
                                    currentButton_color = currentButton_color.split("-")[0];
                                    if (currentButton_color != first_color) {
                                        elem_id.push(currentButton.innerHTML);
                                        elem.push(new_co);
                                    }
                                    shouldContinue = false; // Stop moving in this direction if there's an obstacle
                                } else {
                                    num_piece.push(new_co);
                                }
                            }
                        }
                    }
                    //king black
                    if (piece == 'king' && first_color == 'b') {
                        let [x, y] = first_co.split(',').map(Number);
                        const moves = [
                            [x + 1, y],
                            [x - 1, y],
                            [x, y + 1],
                            [x, y - 1],
                            [x + 1, y + 1],
                            [x + 1, y - 1],
                            [x - 1, y + 1],
                            [x - 1, y - 1]
                        ];

                        for (let [newX, newY] of moves) {
                            let new_co = `${newX},${newY}`;
                            const currentButton = document.querySelector(`button[class$="${new_co}"]`);
                            if (!currentButton || !currentButton.id) {
                                num_piece.push(new_co);
                            }
                            else {
                                let currentButton_color = currentButton.id
                                currentButton_color = currentButton_color.split("-")[0];
                                if (currentButton_color != first_color) {
                                    elem_id.push(currentButton.innerHTML);
                                    elem.push(new_co);
                                }
                            }
                        }
                    }
                    //king-white
                    if (piece == 'king' && first_color == 'w') {
                        let [x, y] = first_co.split(',').map(Number);
                        const moves = [
                            [x + 1, y],
                            [x - 1, y],
                            [x, y + 1],
                            [x, y - 1],
                            [x + 1, y + 1],
                            [x + 1, y - 1],
                            [x - 1, y + 1],
                            [x - 1, y - 1]
                        ];

                        for (let [newX, newY] of moves) {
                            let new_co = `${newX},${newY}`;
                            const currentButton = document.querySelector(`button[class$="${new_co}"]`);
                            if (!currentButton || !currentButton.id) {
                                num_piece.push(new_co);
                            }
                            else {
                                let currentButton_color = currentButton.id
                                currentButton_color = currentButton_color.split("-")[0];
                                if (currentButton_color != first_color) {
                                    elem_id.push(currentButton.innerHTML);
                                    elem.push(new_co);
                                }
                            }
                        }
                    }
                    //castle queen
                    /* 
                    if (!queen_castle_black && piece == 'king' && first_color == 'b' && first_co == "7,4") {
                        let [x, y] = first_co.split(',').map(Number);
                        const currentButton = document.querySelector(`button[class$="${"7,3"}"]`);
                        const currentButton_1 = document.querySelector(`button[class$="${"7,2"}"]`);
                        const currentButton_2 = document.querySelector(`button[class$="${"7,1"}"]`);
                        const currentButton_3 = document.querySelector(`button[class$="${"7,0"}"]`);
                        if (!currentButton.id && !currentButton_1.id && currentButton_2.id && currentButton_3.id) {
                            currentButton_1.innerHTML = '<div style="height: 25px; width: 25px; opacity: 0.75; background-color: #bbb; border-radius: 50%; display: inline-block;"></div>';
                        }
                        queen_castle_black  = true;
                    }
                    else {
                        queen_castle_black  = false;
                   }
                    */

                    //castle black
                    if (!new_castle_black && piece == 'king' && first_color == 'b' && first_co == "7,4") {
                        let [x, y] = first_co.split(',').map(Number);
                        const currentButton = document.querySelector(`button[class$="${"7,5"}"]`);
                        const currentButton_1 = document.querySelector(`button[class$="${"7,6"}"]`);
                        const currentButton_2 = document.querySelector(`button[class$="${"7,7"}"]`);
                        if (!currentButton.id && !currentButton_1.id && currentButton_2.id) {
                            currentButton_1.innerHTML = '<div style="height: 25px; width: 25px; opacity: 0.75; background-color: #bbb; border-radius: 50%; display: inline-block;"></div>';
                        }
                        castle_black = true;
                        new_castle_black = true;
                    }
                    else {
                        castle_black = false;
                    }

                    //castle white
                    if (!new_castle_white && piece == 'king' && first_color == 'w' && first_co == "0,4") {
                        let [x, y] = first_co.split(',').map(Number);
                        const currentButton = document.querySelector(`button[class$="${"0,5"}"]`);
                        const currentButton_1 = document.querySelector(`button[class$="${"0,6"}"]`);
                        const currentButton_2 = document.querySelector(`button[class$="${"0,7"}"]`);
                        if (!currentButton.id && !currentButton_1.id && currentButton_2.id) {
                            currentButton_1.innerHTML = '<div style="height: 25px; width: 25px; opacity: 0.75; background-color: #bbb; border-radius: 50%; display: inline-block;"></div>';
                        }
                        castle_white = true;
                        new_castle_black = true;
                    }
                    else {
                        castle_white = false;
                    }
                    //horse-black
                    if (piece == 'knight' && first_color == 'b') {
                        let [x, y] = first_co.split(',').map(Number);
                        const moves = [
                            [x + 2, y + 1],
                            [x + 2, y - 1],
                            [x - 2, y + 1],
                            [x - 2, y - 1],
                            [x + 1, y + 2],
                            [x + 1, y - 2],
                            [x - 1, y + 2],
                            [x - 1, y - 2]
                        ];

                        for (let [newX, newY] of moves) {
                            let new_co = `${newX},${newY}`;
                            const currentButton = document.querySelector(`button[class$="${new_co}"]`);
                            if (!currentButton || !currentButton.id) {
                                num_piece.push(new_co);
                            }
                            else {
                                let currentButton_color = currentButton.id
                                currentButton_color = currentButton_color.split("-")[0];
                                if (currentButton_color != first_color) {
                                    elem_id.push(currentButton.innerHTML);
                                    elem.push(new_co);
                                }
                            }
                        }
                    }

                    //horse-white
                    if (piece == 'knight' && first_color == 'w') {
                        let [x, y] = first_co.split(',').map(Number);
                        const moves = [
                            [x + 2, y + 1],
                            [x + 2, y - 1],
                            [x - 2, y + 1],
                            [x - 2, y - 1],
                            [x + 1, y + 2],
                            [x + 1, y - 2],
                            [x - 1, y + 2],
                            [x - 1, y - 2]
                        ];

                        for (let [newX, newY] of moves) {
                            let new_co = `${newX},${newY}`;
                            const currentButton = document.querySelector(`button[class$="${new_co}"]`);
                            if (!currentButton || !currentButton.id) {
                                num_piece.push(new_co);
                            }
                            else {
                                let currentButton_color = currentButton.id
                                currentButton_color = currentButton_color.split("-")[0];
                                if (currentButton_color != first_color) {
                                    elem_id.push(currentButton.innerHTML);
                                    elem.push(new_co);
                                }
                            }
                        }
                    }

                    if (firstClick.hasAttribute('id')) {
                        buttons.forEach(button => {
                            let new_id = button.id;
                            new_id = new_id.split('-')[0]
                            if (elem.some(piece => button.classList.contains(piece)) && first_color != new_id) {
                                button.innerHTML += '<div style="height: 40px; width: 40px; opacity: 0.85 ;border: 10px solid #bbb; border-radius:50px;display: flex; z-index: 100; position: absolute;"></div>';
                            }
                            if (num_piece.some(piece => button.classList.contains(piece))) {
                                button.innerHTML = '<div style="height: 25px; width: 25px; opacity: 0.75; background-color: #bbb; border-radius: 50%; display: inline-block;"></div>';
                            }
                        });
                    }
                } else {
                    var secondClick = button;
                    var second_co = secondClick.getAttribute('class').split(' ')[1];
                    var second_id = secondClick.id;
                    var first_co = firstClick.getAttribute('class').split(' ')[1];
                    var first_id = firstClick.id;
                    var first_color = first_id.split('-')[0]
                    var second_color = second_id.split('-')[0];

                    //en_pas_black
                    if (en_pas_black && !secondClick.id) {
                        let [x, y] = first_co.split(',');
                        x = parseInt(x);
                        y = parseInt(y);
                        y = y - 1
                        let new_co = x + ',' + y
                        y = y + 1
                        y = y + 1
                        let new_co_0 = x + ',' + y
                        let temp_co = document.querySelector(`button[class$="${new_co}"]`);
                        let temp_co_0 = document.querySelector(`button[class$="${new_co_0}"]`);
                        if (en_white.includes(new_co) && temp_co.id) {
                            let [x, y] = new_co.split(',');
                            x = parseInt(x);
                            y = parseInt(y);
                            x = x - 1;
                            new_co = x + ',' + y;
                            new_co = document.querySelector(`button[class$="${new_co}"]`);
                            if (secondClick == new_co) {
                                new_co.innerHTML = firstClick.innerHTML;
                                new_co.id = firstClick.id;
                                firstClick.innerHTML = ''
                                temp_co.innerHTML = ''
                                firstClick.id = ''
                                temp_co.id = ''
                            }
                            else {
                                new_co.innerHTML = ''
                            }
                        }
                        if (en_white.includes(new_co_0) && temp_co_0.id) {
                            let [x, y] = new_co_0.split(',');
                            x = parseInt(x);
                            y = parseInt(y);
                            x = x - 1;
                            new_co_0 = x + ',' + y; 
                            new_co_0 = document.querySelector(`button[class$="${new_co_0}"]`);
                            if (secondClick == new_co_0) {
                                new_co_0.innerHTML = firstClick.innerHTML;
                                new_co_0.id = firstClick.id;
                                firstClick.innerHTML = ''
                                temp_co_0.innerHTML = ''
                                firstClick.id = ''
                                temp_co_0.id = ''
                            }
                            else {
                                new_co_0.innerHTML = ''
                            }
                        }
                    }

                    //en-pasant-white
                    if (en_pas_white && !secondClick.id) {
                        let [x, y] = first_co.split(',');
                        x = parseInt(x);
                        y = parseInt(y);
                        y = y + 1
                        let new_co = x + ',' + y
                        y = y - 1
                        y = y - 1
                        let new_co_0 = x + ',' + y
                        let temp_co = document.querySelector(`button[class$="${new_co}"]`);
                        let temp_co_0 = document.querySelector(`button[class$="${new_co_0}"]`);
                        if (en_black.includes(new_co) && temp_co.id) {
                            let [x, y] = new_co.split(',');
                            x = parseInt(x);
                            y = parseInt(y);
                            x = x + 1;
                            new_co = x + ',' + y;
                            new_co = document.querySelector(`button[class$="${new_co}"]`);
                            if (secondClick == new_co) {
                                new_co.innerHTML = firstClick.innerHTML;
                                new_co.id = firstClick.id;
                                firstClick.innerHTML = ''
                                temp_co.innerHTML = ''
                                firstClick.id = ''
                                temp_co.id = ''
                            }
                            else {
                                new_co.innerHTML = ''
                            }
                        }
                        if (en_black.includes(new_co_0) && temp_co_0.id) {
                            let [x, y] = new_co_0.split(',');
                            x = parseInt(x);
                            y = parseInt(y);
                            x = x + 1;
                            new_co_0 = x + ',' + y;
                            new_co_0 = document.querySelector(`button[class$="${new_co_0}"]`);
                            if (secondClick == new_co_0) {
                                new_co_0.innerHTML = firstClick.innerHTML;
                                new_co_0.id = firstClick.id;
                                firstClick.innerHTML = ''
                                temp_co_0.innerHTML = ''
                                firstClick.id = ''
                                temp_co_0.id = ''
                            }
                            else {
                                new_co_0.innerHTML = ''
                            }
                        }
                    }



                    if (!castleExecuted_black && castle_black && second_co == "7,6") {
                        let currentButton = document.querySelector(`button[class$="${"7,4"}"]`);
                        let currentButton_0 = document.querySelector(`button[class$="${"7,5"}"]`);
                        let currentButton_1 = document.querySelector(`button[class$="${"7,6"}"]`);
                        let currentButton_2 = document.querySelector(`button[class$="${"7,7"}"]`);

                        buttons.forEach(button => {
                            if (num_piece.some(piece => button.classList.contains(piece))) {
                                button.innerHTML = null;
                            }
                        });

                        const temp = currentButton_2.innerHTML;
                        currentButton_2.innerHTML = currentButton_0.innerHTML;
                        currentButton_0.innerHTML = temp;
                        currentButton_0.id = currentButton_2.id;
                        currentButton_2.id = '';

                        const temp_1 = currentButton.innerHTML;
                        currentButton.innerHTML = currentButton_1.innerHTML;
                        currentButton_1.innerHTML = temp_1;
                        currentButton_1.id = currentButton.id
                        currentButton.id = ''

                        //secondClick.id = firstClick.id;
                        //secondClick.innerHTML = firstClick.innerHTML;
                        currentButton.innerHTML = null;
                        new_castle_black = false;
                        castleExecuted_black = true;
                        firstClick = null;
                        num_piece = num_piece.slice(0, initialNumPieceLength);
                        elem = elem.slice(0, initialNumPieceLength);
                        elem_id = elem_id.slice(0, initialNumPieceLength);
                    }
                    else if (!castleExecuted_white && castle_white && second_co == "0,6") {
                        let currentButton = document.querySelector(`button[class$="${"0,4"}"]`);
                        let currentButton_0 = document.querySelector(`button[class$="${"0,5"}"]`);
                        let currentButton_1 = document.querySelector(`button[class$="${"0,6"}"]`);
                        let currentButton_2 = document.querySelector(`button[class$="${"0,7"}"]`);

                        buttons.forEach(button => {
                            if (num_piece.some(piece => button.classList.contains(piece))) {
                                button.innerHTML = null;
                            }
                        });

                        const temp = currentButton_2.innerHTML;
                        currentButton_2.innerHTML = currentButton_0.innerHTML;
                        currentButton_0.innerHTML = temp;
                        currentButton_0.id = currentButton_2.id;
                        currentButton_2.id = '';

                        const temp_1 = currentButton.innerHTML;
                        currentButton.innerHTML = currentButton_1.innerHTML;
                        currentButton_1.innerHTML = temp_1;
                        currentButton_1.id = currentButton.id
                        currentButton.id = ''

                        //secondClick.id = firstClick.id;
                        //secondClick.innerHTML = firstClick.innerHTML;
                        currentButton.innerHTML = null;
                        new_castle_white = false;
                        castleExecuted_white = true;
                        firstClick = null;
                        num_piece = num_piece.slice(0, initialNumPieceLength);
                        elem = elem.slice(0, initialNumPieceLength);
                        elem_id = elem_id.slice(0, initialNumPieceLength);
                    }
                    else if (num_piece.some(piece => button.classList.contains(piece)) || elem.some(piece => button.classList.contains(piece))) {
                        if (num_piece.some(piece => button.classList.contains(piece)) && firstClick.id != secondClick.id && first_color != second_color) {
                            buttons.forEach(button => {
                                if (num_piece.some(piece => button.classList.contains(piece)) && second_color != first_color) {
                                    button.innerHTML = null;
                                }
                                if (castle_black) {
                                    const currentButton_1 = document.querySelector(`button[class$="${"7,6"}"]`);
                                    currentButton_1.innerHTML = null;
                                }
                            });
                        }
                        if (elem.some(piece => button.classList.contains(piece))) {
                            buttons.forEach(button => {
                                if (num_piece.some(piece => button.classList.contains(piece)) && second_color != first_color) {
                                    button.innerHTML = null;
                                }
                            });
                        }
                        buttons.forEach(button => {
                            elem.forEach((piece, index) => {
                                if (button.classList.contains(piece)) {
                                    button.innerHTML = elem_id[index];
                                }
                            });
                        });
                        secondClick.id = firstClick.id;
                        secondClick.innerHTML = firstClick.innerHTML;
                        firstClick.id = '';
                        firstClick.innerHTML = null;
                        firstClick = null;
                        num_piece = num_piece.slice(0, initialNumPieceLength);
                        elem = elem.slice(0, initialNumPieceLength);
                        elem_id = elem_id.slice(0, initialNumPieceLength);
                    }
                    else {
                        buttons.forEach(button => {
                            if (!new_castle_white || !new_castle_black) {
                                if (num_piece.some(piece => button.classList.contains(piece)) || num_piece.includes(piece)) {
                                    button.innerHTML = null;
                                }
                            }
                            if (castle_black) {
                                const currentButton_1 = document.querySelector(`button[class$="${"7,6"}"]`);
                                if(!currentButton_1.id){
                                    currentButton_1.innerHTML = null;
                                }
                            }
                            if (castle_white) {
                                const currentButton_1 = document.querySelector(`button[class$="${"0,6"}"]`);
                                if(!currentButton_1.id){
                                    currentButton_1.innerHTML = null;
                                }
                            }
                        });
                        buttons.forEach(button => {
                            elem.forEach((piece, index) => {
                                if (button.classList.contains(piece)) {
                                    button.innerHTML = elem_id[index];
                                }
                            });
                        });
                        firstClick = null;
                        num_piece = num_piece.slice(0, initialNumPieceLength);
                        elem = elem.slice(0, initialNumPieceLength);
                        elem_id = elem_id.slice(0, initialNumPieceLength);
                    }
                }
            };
        }
        );

    </script>

</body>

</html>